<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro - PARDARIA</title>
<link rel="stylesheet" href="login.css">
</head>
<body>
<div class="container">
<div class="login-card">
<div class="logo">
<h1>üçû PARDARIA</h1>
<p>Padaria Artesanal</p>
</div>
<div class="form-content-area">
<div class="tab-content active">
<h2>Cadastro</h2>
<form id="cadastroForm">
<div class="form-group">
<label for="regNome">Nome Completo:</label>
<input type="text" id="regNome" name="nome" maxlength="100" required>
</div>
<div class="form-group">
<label for="regCpf">CPF:</label>
<input type="text" id="regCpf" name="cpf" maxlength="14" placeholder="000.000.000-00" required>
<small>Digite apenas n√∫meros</small>
</div>
<div class="form-group">
<label for="regEmail">Email:</label>
<input type="email" id="regEmail" name="email" maxlength="100" required>
</div>
<div class="form-group">
<label for="regSenha">Senha:</label>
<input type="password" id="regSenha" name="senha" maxlength="20" minlength="6" required>
<small>M√≠nimo 6 caracteres, m√°ximo 20</small>
</div>
<button type="submit" class="btn-register">Cadastrar</button>
<div id="mensagemCadastro" class="mensagem"></div>
</form>
<p class="login-link">
J√° tem conta? <a href="login.html">Fa√ßa login aqui</a>
</p>
</div>
</div>
</div>
</div>
<script type="module">
import { registrar, mostrarMensagem } from './auth.js';

const cadastroForm = document.getElementById('cadastroForm');
const mensagemCadastro = document.getElementById('mensagemCadastro');

// Formata√ß√£o do CPF
document.getElementById('regCpf').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 11) {
        value = value.substring(0, 11);
    }
    if (value.length <= 11) {
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    }
    e.target.value = value;
});

cadastroForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const cpfFormatted = document.getElementById('regCpf').value;
    const cpfClean = cpfFormatted.replace(/\D/g, '');
    
    const user = {
        name: document.getElementById('regNome').value.trim(),
        cpf: cpfClean,
        email: document.getElementById('regEmail').value.trim(),
        password: document.getElementById('regSenha').value
    };
    
    // Valida√ß√µes
    if (cpfClean.length !== 11) {
        mostrarMensagem(mensagemCadastro, 'CPF deve ter 11 d√≠gitos', 'erro');
        return;
    }
    
    if (user.password.length < 6) {
        mostrarMensagem(mensagemCadastro, 'Senha deve ter no m√≠nimo 6 caracteres', 'erro');
        return;
    }
    
    if (user.password.length > 20) {
        mostrarMensagem(mensagemCadastro, 'Senha deve ter no m√°ximo 20 caracteres', 'erro');
        return;
    }
    
    const btn = cadastroForm.querySelector('.btn-register');
    const originalText = btn.textContent;
    btn.textContent = 'Criando conta...';
    btn.disabled = true;
    
    try {
        const data = await registrar(user);
        
        if (data.logged && data.user) {
            mostrarMensagem(mensagemCadastro, 'Cadastro realizado com sucesso! Redirecionando...', 'sucesso');
            setTimeout(() => {
                window.location.href = '../menu.html';
            }, 1500);
        } else {
            mostrarMensagem(mensagemCadastro, data.error || 'Erro no cadastro', 'erro');
        }
    } catch (err) {
        console.error(err);
        mostrarMensagem(mensagemCadastro, 'Falha na conex√£o com o servidor', 'erro');
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
});
</script>
</body>
</html>